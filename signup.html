<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Join - AnimeExplorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #7c4dff;
            --primary-glow: rgba(124, 77, 255, 0.5);
            --accent: #00e5ff;
            --bg-dark: #050507;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body, html {
            width: 100%; height: 100%;
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-dark);
            color: white;
            overflow: hidden;
            display: flex; align-items: center; justify-content: center;
        }

        /* --- Animated Mesh Background --- */
        .bg-container {
            position: fixed; inset: 0; z-index: -1;
            background: radial-gradient(circle at 50% 50%, #12121c 0%, #050507 100%);
        }

        .blob {
            position: absolute; width: 450px; height: 450px;
            background: var(--primary);
            filter: blur(120px); border-radius: 50%; opacity: 0.15;
            animation: move 20s infinite alternate;
        }
        .blob-2 { background: var(--accent); animation-duration: 15s; right: -100px; top: -100px; }

        @keyframes move {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(-100px, 150px) scale(1.2); }
        }

        /* --- Signup Card Design --- */
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            border-radius: 35px;
            padding: 45px 40px;
            width: 90%;
            max-width: 420px;
            text-align: center;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.5);
            animation: cardEntrance 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        @keyframes cardEntrance {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .brand-logo {
            font-size: 32px; font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, var(--primary-light) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .subtitle { color: rgba(255,255,255,0.4); font-size: 14px; margin-bottom: 30px; }

        /* --- Stylish Inputs --- */
        .auth-form { display: flex; flex-direction: column; gap: 16px; }
        
        .input-group { position: relative; text-align: left; }
        .input-group i { 
            position: absolute; left: 18px; top: 50%; 
            transform: translateY(-50%); color: rgba(255,255,255,0.3);
            font-size: 14px;
        }

        .input-group input {
            width: 100%; padding: 15px 15px 15px 50px;
            background: rgba(255,255,255,0.04);
            border: 1px solid transparent; border-radius: 16px;
            color: white; font-size: 14px; transition: 0.4s;
            outline: none;
        }

        .input-group input:focus {
            background: rgba(255,255,255,0.08);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(124, 77, 255, 0.2);
        }

        .input-group input:focus + i { color: var(--primary); }

        /* --- Signup Button --- */
        .signup-btn {
            background: var(--primary);
            color: white; border: none; padding: 16px;
            border-radius: 16px; font-weight: 700; font-size: 16px;
            cursor: pointer; transition: 0.3s;
            box-shadow: 0 10px 20px var(--primary-glow);
            margin-top: 10px;
        }

        .signup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px var(--primary-glow);
            filter: brightness(1.1);
        }

        #status {
            margin-top: 18px; font-size: 13px; font-weight: 500;
            min-height: 20px;
        }

        .footer-link {
            margin-top: 25px; font-size: 14px; color: rgba(255,255,255,0.4);
        }
        .footer-link a { color: var(--primary); text-decoration: none; font-weight: 700; }
    </style>
</head>
<body>

    <div class="bg-container">
        <div class="blob"></div>
        <div class="blob blob-2"></div>
    </div>

    <div class="card">
        <div class="brand-logo">AnimeExplorer</div>
        <p class="subtitle">Create an account to start exploring</p>

        <div class="auth-form">
            <div class="input-group">
                <i class="fas fa-user"></i>
                <input type="text" id="username" placeholder="Your Name">
            </div>
            <div class="input-group">
                <i class="fas fa-envelope"></i>
                <input type="email" id="email" placeholder="Email Address">
            </div>
            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" id="password" placeholder="Password (Min 6 chars)">
            </div>
            <button id="signupBtn" class="signup-btn">Get Started</button>
        </div>
        
        <p id="status"></p>

        <div class="footer-link">
            Already have an account? <a href="login.html">Sign In</a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, runTransaction } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDLd3TW-y89lwShUmcIHw3YGzDjo4cg3y4",
            authDomain: "animea2z.firebaseapp.com",
            projectId: "animea2z",
            storageBucket: "animea2z.firebasestorage.app",
            messagingSenderId: "673605765684",
            appId: "1:673605765684:web:a6f851e0d79836b79b1861"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const status = document.getElementById('status');
        const signupBtn = document.getElementById('signupBtn');

        signupBtn.addEventListener('click', async () => {
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();

            if(!username || !email || !password) {
                updateStatus("Please fill all fields", "#ff5252");
                return;
            }

            try {
                signupBtn.disabled = true;
                signupBtn.innerText = "Creating Account...";
                updateStatus("Processing...", "#fff");

                // 1. Auth Creation
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // 2. Sequential ID Logic (1000001+)
                let customId = "1000001";
                try {
                    customId = await runTransaction(db, async (transaction) => {
                        const counterRef = doc(db, "settings", "userCounter");
                        const counterDoc = await transaction.get(counterRef);
                        let nextId = 1000001;
                        if (counterDoc.exists()) {
                            nextId = counterDoc.data().lastId + 1;
                        }
                        transaction.set(counterRef, { lastId: nextId });
                        return String(nextId);
                    });
                } catch (e) { customId = Date.now().toString().slice(-7); }

                // 3. Firestore Profile
                await setDoc(doc(db, "users", user.uid), {
                    uid: user.uid,
                    customId: customId,
                    username: username,
                    email: email,
                    avatar: `https://ui-avatars.com/api/?name=${username}&background=7c4dff&color=fff`,
                    xp: 0,
                    isOnline: true,
                    joinedAt: new Date().toLocaleDateString(),
                    bio: "Anime fan on AnimeExplorer!"
                });

                updateStatus("Welcome! Redirecting...", "#4caf50");
                setTimeout(() => window.location.href = "index.html", 1500);

            } catch (error) {
                signupBtn.disabled = false;
                signupBtn.innerText = "Get Started";
                updateStatus(error.message, "#ff5252");
            }
        });

        function updateStatus(msg, color) {
            status.style.color = color;
            status.innerText = msg;
        }
    </script>
</body>
</html>
